# Track 規格說明書：網頁單字自動高亮 (Smart Context Highlight)

## 1. 概觀 (Overview)
本 Track 旨在實作「網頁單字自動高亮」功能。當使用者瀏覽任何網頁時，擴充功能應自動偵測並高亮顯示使用者曾經收藏在「單字本」中的單字。這能將被動的查詢轉化為「間隔重複」的主動複習機會，增加學習成效。

## 2. 功能需求 (Functional Requirements)
- **自動偵測與高亮**：
    - 當網頁載入時，自動掃描頁面內文。
    - 比對 `chrome.storage.local` 中的收藏單字。
    - 若比對成功，對該單字套用「淡色背景 (Soft Highlight)」樣式。
- **懸停互動 (Hover Interaction)**：
    - 當游標滑過高亮單字時，自動顯示一個輕量級的 Tooltip。
    - Tooltip 內容應包含該單字收藏時的「譯文」。
    - 移開游標後 Tooltip 消失。
- **使用者設定控制**：
    - **全域開關**：在 Popup 設定頁面增加「顯示收藏單字高亮」開關。
    - **字數過濾**：自動忽略長度小於 3 個字元的單字（如 a, is, on）。
    - **網域黑名單**：允許使用者將當前網站加入「不啟用高亮」清單。

## 3. 非功能需求 (Non-Functional Requirements)
- **效能優化 (Performance)**：
    - 掃描與高亮操作不得顯著拖慢網頁載入速度。
    - 建議使用 `TreeWalker` API 或類似的高效 DOM 遍歷技術。
    - 應限制單頁高亮的最大數量（例如前 100 個匹配項），避免極端情況下的卡頓。
- **視覺相容性**：
    - 高亮樣式不應破壞網頁原有的排版結構 (Layout)。
    - Tooltip 的 `z-index` 必須足夠高，避免被網頁元素遮擋。

## 4. 驗收標準 (Acceptance Criteria)
- [ ] 開啟任意含有收藏單字的網頁，該單字應自動呈現淡黃色背景。
- [ ] 滑鼠懸停於高亮單字上，應立即顯示包含正確譯文的 Tooltip。
- [ ] 在 Popup 關閉此功能後，重新整理網頁，高亮應消失。
- [ ] 短單字（< 3 字元）即使在收藏列表中，也不應被高亮。
- [ ] 使用者可將當前網域加入黑名單，該網域即不再顯示高亮。

## 5. 範圍外 (Out of Scope)
- 支援片語或跨行句子的自動高亮（MVP 僅支援單字或短詞）。
- 支援動態載入內容（如無限滾動頁面）的即時偵測（MVP 僅針對初次載入內容，或簡單的 DOM 變動監聽）。
