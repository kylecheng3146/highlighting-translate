# 功能規格書：Smart Context Cards

## 1. 概述 (Overview)

將擴充功能從單純的「單字列」升級為「情境學習工具」。核心在於捕捉單字被查詢時的「完整例句」，並在歷史紀錄中以卡片形式呈現，幫助使用者透過真實情境記憶單字。

## 2. 功能需求 (Functional Requirements)

### 2.1 自動情境擷取 (Auto-Context Capture)

- **觸發時機**：當使用者選取網頁文字並產生翻譯視窗時。
- **擷取範圍**：智慧擴展選取範圍至完整的「句子」邊界（以句號、問號、驚嘆號或 HTML 區塊元素為界）。
- **限制**：
  - 上下文長度限制（例如：最大 300 字元），避免抓取過長段落。
  - 若無法偵測明確句點，則抓取前後一定數量的字元。

### 2.2 翻譯視窗預覽 (Popup Preview)

- **收藏功能**：使用者點擊「星星（收藏）」按鈕時，將單字、翻譯結果以及**擷取到的情境**一同儲存至 Storage。
- **視覺回饋**：(選配) 在 Popup 中可選擇性顯示抓取到的例句預覽。

### 2.3 歷史卡片介面 (History Card UI)

- **卡片式呈現**：取代原有的清單列表，改為卡片式佈局。
- **內容顯示**：
  - **核心單字**：顯示原文與翻譯。
  - **情境例句**：顯示完整的擷取句子。
  - **情境高亮**：在例句中，將核心單字以**粗體**或**背景色**高亮顯示。
- **來源追溯**：顯示來源 URL 與時間戳記。

## 3. 非功能需求

- **隱私**：情境資料僅儲存於本地 (Local Storage) 或同步 (Sync Storage)，不傳送至第三方伺服器。
- **效能**：擷取邏輯不得造成 UI 凍結。

## 4. 驗收標準

- [ ] 在任意網頁選取文字，翻譯視窗正常顯示。
- [ ] 點擊收藏後，歷史頁面出現新卡片。
- [ ] 卡片顯示完整的來源例句。
- [ ] 例句中的目標單字有被正確高亮。
- [ ] 舊有資料（無情境）仍能正常顯示，不造成錯誤。
